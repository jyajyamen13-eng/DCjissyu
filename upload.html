<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordæ–‡æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - å®Ÿç¿’è¨ˆç”»æ›¸</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Wordæ–‡æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h1>
            <div class="action-buttons no-print">
                <button onclick="location.href='index.html'" class="btn btn-secondary">ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            </div>
        </header>

        <section class="section">
            <h2>å®Ÿç¿’è¨ˆç”»æ›¸ Wordæ–‡æ›¸ (.docx) ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“¤</div>
                <h3>ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</h3>
                <p>ã¾ãŸã¯</p>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                </button>
                <input type="file" id="fileInput" accept=".docx" style="display: none;" onchange="handleFile(this.files[0])">
                <p class="file-info">å¯¾å¿œå½¢å¼: .docxï¼ˆMicrosoft Wordæ–‡æ›¸ï¼‰</p>
            </div>

            <div id="progressArea" style="display: none; margin-top: 20px;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <p id="progressText" style="text-align: center; margin-top: 10px;">å‡¦ç†ä¸­...</p>
            </div>

            <div id="previewArea" style="display: none; margin-top: 20px;">
                <h3>æŠ½å‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div id="previewContent" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="applyToForm()">âœ… ãƒ•ã‚©ãƒ¼ãƒ ã«é©ç”¨</button>
                    <button class="btn btn-secondary" onclick="resetUpload()">ğŸ”„ ã‚„ã‚Šç›´ã™</button>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“‹ æ©Ÿèƒ½èª¬æ˜</h2>
            <ul style="line-height: 2; color: #333;">
                <li>âœ… Wordæ–‡æ›¸ã‹ã‚‰å®Ÿç¿’è¨ˆç”»æ›¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æŠ½å‡º</li>
                <li>âœ… åˆ©ç”¨è€…åã‚’è‡ªå‹•çš„ã«ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ã«å¤‰æ›ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ï¼‰</li>
                <li>âœ… æ—¥ä»˜ã€é›»è©±ç•ªå·ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è‡ªå‹•èªè­˜</li>
                <li>âœ… ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›ã—ã¦ç·¨é›†å¯èƒ½</li>
                <li>âœ… PDFå‡ºåŠ›ã‚„ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚‚å¯èƒ½</li>
            </ul>
        </section>

        <footer class="footer no-print">
            <p>ãƒ‡ã‚£ãƒ¼ã‚­ãƒ£ãƒªã‚¢ã„ã‚ã¦ãƒ»ç››å²¡ã‚ªãƒ•ã‚£ã‚¹</p>
            <p>TEL: 019-651-7380 / Email: iwate-morioka@dd-career.com</p>
        </footer>
    </div>

    <script>
        let extractedData = {};
        let fileName = '';

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#667eea';
            uploadArea.style.background = 'rgba(102, 126, 234, 0.1)';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = 'white';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
        function handleFile(file) {
            if (!file) return;

            if (!file.name.endsWith('.docx')) {
                alert('âš ï¸ .docxå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            fileName = file.name;
            showProgress('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...');

            const reader = new FileReader();
            reader.onload = function(e) {
                parseDocx(e.target.result);
            };
            reader.readAsArrayBuffer(file);
        }

        // Wordæ–‡æ›¸ã®è§£æ
        async function parseDocx(arrayBuffer) {
            try {
                showProgress('Wordæ–‡æ›¸ã‚’è§£æä¸­...');

                const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                const text = result.value;

                extractedData = extractDataFromText(text);
                
                showProgress('ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ä¸­...');
                setTimeout(() => {
                    showPreview(extractedData);
                    hideProgress();
                }, 500);

            } catch (error) {
                console.error('è§£æã‚¨ãƒ©ãƒ¼:', error);
                alert('âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                hideProgress();
            }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
        function extractDataFromText(text) {
            const data = {};

            // åˆ©ç”¨è€…åã®æŠ½å‡ºã¨ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«å¤‰æ›
            const nameMatch = text.match(/åˆ©ç”¨è€…å[ï¼š:\s]*([^\s\n]+)/);
            if (nameMatch) {
                data.userName = convertToInitials(nameMatch[1]);
            }

            // ç”Ÿå¹´æœˆæ—¥
            const birthMatch = text.match(/ç”Ÿå¹´æœˆæ—¥[ï¼š:\s]*(\d{4})[å¹´\/\-](\d{1,2})[æœˆ\/\-](\d{1,2})/);
            if (birthMatch) {
                data.birthDate = `${birthMatch[1]}-${birthMatch[2].padStart(2, '0')}-${birthMatch[3].padStart(2, '0')}`;
            }

            // æ€§åˆ¥
            if (text.includes('ç”·æ€§')) data.gender = 'ç”·æ€§';
            else if (text.includes('å¥³æ€§')) data.gender = 'å¥³æ€§';

            // é€šæ‰€é–‹å§‹æ—¥
            const startMatch = text.match(/é€šæ‰€é–‹å§‹æ—¥[ï¼š:\s]*(\d{4})[å¹´\/\-](\d{1,2})[æœˆ\/\-](\d{1,2})/);
            if (startMatch) {
                data.startDate = `${startMatch[1]}-${startMatch[2].padStart(2, '0')}-${startMatch[3].padStart(2, '0')}`;
            }

            // ä¼æ¥­å
            const companyMatch = text.match(/(?:å®Ÿç¿’å…ˆ|ä¼æ¥­å)[ï¼š:\s]*([^\n]+)/);
            if (companyMatch) {
                data.companyName = companyMatch[1].trim();
            }

            // å®Ÿç¿’æœŸé–“
            const periodMatch = text.match(/å®Ÿç¿’æœŸé–“[ï¼š:\s]*(\d{4})[å¹´\/\-](\d{1,2})[æœˆ\/\-](\d{1,2})[^\d]*(\d{4})[å¹´\/\-](\d{1,2})[æœˆ\/\-](\d{1,2})/);
            if (periodMatch) {
                data.internshipStart = `${periodMatch[1]}-${periodMatch[2].padStart(2, '0')}-${periodMatch[3].padStart(2, '0')}`;
                data.internshipEnd = `${periodMatch[4]}-${periodMatch[5].padStart(2, '0')}-${periodMatch[6].padStart(2, '0')}`;
            }

            // å®Ÿç¿’æ™‚é–“
            const timeMatch = text.match(/å®Ÿç¿’æ™‚é–“[ï¼š:\s]*(\d{1,2})[ï¼š:](\d{2})[^\d]*(\d{1,2})[ï¼š:](\d{2})/);
            if (timeMatch) {
                data.timeStart = `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;
                data.timeEnd = `${timeMatch[3].padStart(2, '0')}:${timeMatch[4]}`;
            }

            // é›»è©±ç•ªå·
            const phoneMatch = text.match(/(\d{2,4}[-\s]?\d{2,4}[-\s]?\d{4})/);
            if (phoneMatch) {
                data.phone = phoneMatch[1];
            }

            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
            const emailMatch = text.match(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);
            if (emailMatch) {
                data.email = emailMatch[1];
            }

            // å®Ÿç¿’å†…å®¹
            const contentMatch = text.match(/å®Ÿç¿’å†…å®¹[ï¼š:\s]*([^\n]+(?:\n[^\n]+)*?)(?=\n\n|$)/);
            if (contentMatch) {
                data.internshipContent = contentMatch[1].trim();
            }

            // å®Ÿç¿’ç›®æ¨™
            const goalsMatch = text.match(/å®Ÿç¿’ç›®æ¨™[ï¼š:\s]*([^\n]+(?:\n[^\n]+)*?)(?=\n\n|$)/);
            if (goalsMatch) {
                data.goals = goalsMatch[1].trim();
            }

            return data;
        }

        // ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«å¤‰æ›é–¢æ•°
        function convertToInitials(name) {
            name = name.trim();
            
            // æ—¥æœ¬èªåã®å‡¦ç†ï¼ˆæ¼¢å­—ã€ã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠï¼‰
            if (/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(name)) {
                // ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
                const parts = name.split(/\s+/);
                return parts.map(part => part.charAt(0) + '.').join('');
            }
            
            // è‹±èªåã®å‡¦ç†
            else if (/^[A-Za-z\s]+$/.test(name)) {
                const parts = name.split(/\s+/);
                return parts.map(part => part.charAt(0).toUpperCase() + '.').join('');
            }
            
            // ãã®ä»–ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            return name;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        function showPreview(data) {
            const previewContent = document.getElementById('previewContent');
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            
            const labels = {
                userName: 'åˆ©ç”¨è€…åï¼ˆã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ï¼‰',
                birthDate: 'ç”Ÿå¹´æœˆæ—¥',
                gender: 'æ€§åˆ¥',
                startDate: 'é€šæ‰€é–‹å§‹æ—¥',
                companyName: 'å®Ÿç¿’å…ˆä¼æ¥­å',
                internshipStart: 'å®Ÿç¿’é–‹å§‹æ—¥',
                internshipEnd: 'å®Ÿç¿’çµ‚äº†æ—¥',
                timeStart: 'å®Ÿç¿’é–‹å§‹æ™‚åˆ»',
                timeEnd: 'å®Ÿç¿’çµ‚äº†æ™‚åˆ»',
                phone: 'é›»è©±ç•ªå·',
                email: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
                internshipContent: 'å®Ÿç¿’å†…å®¹',
                goals: 'å®Ÿç¿’ç›®æ¨™'
            };

            for (const [key, value] of Object.entries(data)) {
                if (value) {
                    html += `
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 10px; font-weight: bold; width: 200px; background: #f5f5f5;">${labels[key] || key}</td>
                            <td style="padding: 10px;">${value}</td>
                        </tr>
                    `;
                }
            }

            html += '</table>';
            previewContent.innerHTML = html;
            
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('previewArea').style.display = 'block';
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã«é©ç”¨
        function applyToForm() {
            // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            localStorage.setItem('formData', JSON.stringify(extractedData));
            localStorage.setItem('uploadedFileName', fileName);
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«é·ç§»ï¼ˆè‡ªå‹•èª­ã¿è¾¼ã¿ãƒ•ãƒ©ã‚°ä»˜ãï¼‰
            window.location.href = 'index.html?autoload=true';
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetUpload() {
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('previewArea').style.display = 'none';
            document.getElementById('fileInput').value = '';
            extractedData = {};
            fileName = '';
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
        function showProgress(message) {
            document.getElementById('progressText').textContent = message;
            document.getElementById('progressArea').style.display = 'block';
            document.getElementById('uploadArea').style.opacity = '0.5';
        }

        function hideProgress() {
            document.getElementById('progressArea').style.display = 'none';
            document.getElementById('uploadArea').style.opacity = '1';
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            const errorMessage = document.createElement('div');
            errorMessage.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #f44336;
                color: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 9999;
                max-width: 400px;
            `;
            errorMessage.innerHTML = `<strong>âŒ ã‚¨ãƒ©ãƒ¼</strong><br>${message}`;
            document.body.appendChild(errorMessage);

            setTimeout(() => {
                errorMessage.remove();
            }, 5000);
        }
    </script>

    <style>
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .file-info {
            color: #666;
            font-size: 14px;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }
    </style>
</body>
</html>
